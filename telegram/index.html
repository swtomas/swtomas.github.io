import React, { useState, useEffect, useRef } from 'react';
import { Send, Settings, MessageSquare, History, X, Plus, Image, Loader, ChevronDown } from 'lucide-react';

const API_BASE = 'https://enter.pollinations.ai/api';

const App = () => {
  const [isInTelegram, setIsInTelegram] = useState(true);
  const [currentTab, setCurrentTab] = useState('chat');
  const [chats, setChats] = useState([]);
  const [currentChatId, setCurrentChatId] = useState(null);
  const [message, setMessage] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [models, setModels] = useState([]);
  const [selectedModel, setSelectedModel] = useState('openai');
  const [showModelSelector, setShowModelSelector] = useState(false);
  const [userName, setUserName] = useState('–î—Ä—É–≥');
  const [settings, setSettings] = useState({
    streaming: true,
    systemPrompt: '–¢—ã —É–º–Ω—ã–π AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –æ—Ç–≤–µ—Ç—å —Å–ª–æ–≤–æ–º "image" –∏ –æ–ø–∏—Å–∞–Ω–∏–µ–º –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º.',
    temperature: 0.7,
  });
  const [uploadedImage, setUploadedImage] = useState(null);
  const messagesEndRef = useRef(null);
  const fileInputRef = useRef(null);

  useEffect(() => {
    if (window.Telegram?.WebApp) {
      setIsInTelegram(true);
      const tg = window.Telegram.WebApp;
      tg.ready();
      tg.expand();
      
      if (tg.initDataUnsafe?.user?.first_name) {
        setUserName(tg.initDataUnsafe.user.first_name);
      }
    }

    fetchModels();

    const savedChats = localStorage.getItem('pollinations_chats');
    if (savedChats) {
      try {
        const parsedChats = JSON.parse(savedChats);
        setChats(parsedChats);
        if (parsedChats.length > 0) {
          setCurrentChatId(parsedChats[0].id);
        }
      } catch (error) {
        createNewChat();
      }
    } else {
      createNewChat();
    }

    const savedSettings = localStorage.getItem('pollinations_settings');
    if (savedSettings) {
      try {
        setSettings(JSON.parse(savedSettings));
      } catch (error) {
        console.error('Error loading settings:', error);
      }
    }

    const savedModel = localStorage.getItem('pollinations_model');
    if (savedModel) {
      setSelectedModel(savedModel);
    }
  }, []);

  useEffect(() => {
    scrollToBottom();
  }, [chats, currentChatId]);

  useEffect(() => {
    if (chats.length > 0) {
      localStorage.setItem('pollinations_chats', JSON.stringify(chats));
    }
  }, [chats]);

  useEffect(() => {
    localStorage.setItem('pollinations_settings', JSON.stringify(settings));
  }, [settings]);

  useEffect(() => {
    localStorage.setItem('pollinations_model', selectedModel);
  }, [selectedModel]);

  const fetchModels = async () => {
    try {
      const response = await fetch(`${API_BASE}/generate/text/models`);
      const data = await response.json();
      setModels(data);
    } catch (error) {
      console.error('Error fetching models:', error);
    }
  };

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  };

  const createNewChat = () => {
    const newChat = {
      id: Date.now().toString(),
      title: '–ù–æ–≤—ã–π —á–∞—Ç',
      messages: [],
      createdAt: new Date().toISOString(),
    };
    setChats(prev => [newChat, ...prev]);
    setCurrentChatId(newChat.id);
  };

  const getCurrentChat = () => {
    return chats.find(chat => chat.id === currentChatId);
  };

  const updateChatTitle = (chatId, firstMessage) => {
    setChats(prev => prev.map(chat => 
      chat.id === chatId && chat.title === '–ù–æ–≤—ã–π —á–∞—Ç'
        ? { ...chat, title: firstMessage.slice(0, 20) + (firstMessage.length > 20 ? '...' : '') }
        : chat
    ));
  };

  const handleImageUpload = (e) => {
    const file = e.target.files?.[0];
    if (file) {
      const reader = new FileReader();
      reader.onloadend = () => {
        setUploadedImage(reader.result);
      };
      reader.readAsDataURL(file);
    }
  };

  const generateImage = async (prompt) => {
    try {
      const imageUrl = `${API_BASE}/generate/image?prompt=${encodeURIComponent(prompt)}&width=1024&height=1024&nologo=true`;
      return imageUrl;
    } catch (error) {
      console.error('Error generating image:', error);
      return null;
    }
  };

  const sendMessage = async () => {
    if (!message.trim() && !uploadedImage) return;

    const currentChat = getCurrentChat();
    if (!currentChat) return;

    const userMessage = {
      role: 'user',
      content: message,
      image: uploadedImage,
      timestamp: new Date().toISOString(),
    };

    setChats(prev => prev.map(chat => 
      chat.id === currentChatId
        ? { ...chat, messages: [...chat.messages, userMessage] }
        : chat
    ));

    if (currentChat.messages.length === 0) {
      updateChatTitle(currentChatId, message);
    }

    const currentMessage = message;
    setMessage('');
    const tempImage = uploadedImage;
    setUploadedImage(null);
    setIsLoading(true);

    try {
      if (currentMessage.toLowerCase().includes('image') || currentMessage.toLowerCase().includes('–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ')) {
        const assistantMessage = {
          role: 'assistant',
          content: '–ì–µ–Ω–µ—Ä–∏—Ä—É—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ...',
          timestamp: new Date().toISOString(),
          isGenerating: true,
        };

        setChats(prev => prev.map(chat => 
          chat.id === currentChatId
            ? { ...chat, messages: [...chat.messages, assistantMessage] }
            : chat
        ));

        const imagePrompt = currentMessage.replace(/image|–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ/gi, '').trim();
        const imageUrl = await generateImage(imagePrompt || 'beautiful landscape');

        setChats(prev => prev.map(chat => 
          chat.id === currentChatId
            ? {
                ...chat,
                messages: chat.messages.map((msg, idx) =>
                  idx === chat.messages.length - 1
                    ? { ...msg, content: `![Generated Image](${imageUrl})`, isGenerating: false, image: imageUrl }
                    : msg
                ),
              }
            : chat
        ));

        setIsLoading(false);
        return;
      }

      const chatMessages = currentChat.messages.filter(msg => msg.role !== 'system');
      const messages = [
        { role: 'system', content: settings.systemPrompt },
        ...chatMessages.map(msg => ({
          role: msg.role,
          content: msg.content,
        })),
      ];

      const lastUserMessage = { role: 'user', content: currentMessage };
      if (tempImage) {
        lastUserMessage.images = [tempImage];
      }
      messages.push(lastUserMessage);

      const requestBody = {
        messages,
        model: selectedModel,
        temperature: settings.temperature,
        stream: settings.streaming,
      };

      if (settings.streaming) {
        const assistantMessage = {
          role: 'assistant',
          content: '',
          timestamp: new Date().toISOString(),
        };

        setChats(prev => prev.map(chat => 
          chat.id === currentChatId
            ? { ...chat, messages: [...chat.messages, assistantMessage] }
            : chat
        ));

        const response = await fetch(`${API_BASE}/generate/text`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(requestBody),
        });

        const reader = response.body?.getReader();
        if (!reader) {
          throw new Error('Stream not available');
        }

        const decoder = new TextDecoder();
        let buffer = '';

        while (true) {
          const { done, value } = await reader.read();
          if (done) break;

          buffer += decoder.decode(value, { stream: true });
          const lines = buffer.split('\n');
          buffer = lines.pop() || '';

          for (const line of lines) {
            if (line.startsWith('data: ')) {
              try {
                const jsonStr = line.slice(6).trim();
                if (jsonStr === '[DONE]') continue;
                
                const data = JSON.parse(jsonStr);
                if (data.content || data.delta?.content) {
                  const content = data.content || data.delta?.content || '';
                  setChats(prev => prev.map(chat => 
                    chat.id === currentChatId
                      ? {
                          ...chat,
                          messages: chat.messages.map((msg, idx) =>
                            idx === chat.messages.length - 1
                              ? { ...msg, content: msg.content + content }
                              : msg
                          ),
                        }
                      : chat
                  ));
                }
              } catch (e) {
                console.error('Parse error:', e);
              }
            }
          }
        }
      } else {
        const response = await fetch(`${API_BASE}/generate/text`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(requestBody),
        });

        const data = await response.json();
        const assistantMessage = {
          role: 'assistant',
          content: data.content || data.text || data.choices?.[0]?.message?.content || '–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞.',
          timestamp: new Date().toISOString(),
        };

        setChats(prev => prev.map(chat => 
          chat.id === currentChatId
            ? { ...chat, messages: [...chat.messages, assistantMessage] }
            : chat
        ));
      }
    } catch (error) {
      console.error('Error sending message:', error);
      const errorMessage = {
        role: 'assistant',
        content: '–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è.',
        timestamp: new Date().toISOString(),
      };

      setChats(prev => prev.map(chat => 
        chat.id === currentChatId
          ? { ...chat, messages: [...chat.messages, errorMessage] }
          : chat
      ));
    }

    setIsLoading(false);
  };

  const deleteChat = (chatId) => {
    setChats(prev => {
      const filtered = prev.filter(chat => chat.id !== chatId);
      if (currentChatId === chatId && filtered.length > 0) {
        setCurrentChatId(filtered[0].id);
      } else if (filtered.length === 0) {
        createNewChat();
      }
      return filtered;
    });
  };

  const getGreeting = () => {
    const hour = new Date().getHours();
    if (hour < 6) return '–î–æ–±—Ä–æ–π –Ω–æ—á–∏';
    if (hour < 12) return '–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ';
    if (hour < 18) return '–î–æ–±—Ä—ã–π –¥–µ–Ω—å';
    return '–î–æ–±—Ä—ã–π –≤–µ—á–µ—Ä';
  };

  const renderMarkdown = (text) => {
    if (!text) return '';
    
    let html = text
      .replace(/!\[([^\]]*)\]\(([^)]+)\)/g, '<img src="$2" alt="$1" class="message-image" />')
      .replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>')
      .replace(/\*([^*]+)\*/g, '<em>$1</em>')
      .replace(/`([^`]+)`/g, '<code>$1</code>')
      .replace(/\n/g, '<br />');
    
    return html;
  };

  if (!isInTelegram && typeof window !== 'undefined') {
    return (
      <div className="flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
        <div className="text-center p-8 bg-white rounded-3xl shadow-2xl max-w-md animate-fadeIn">
          <div className="text-6xl mb-4">üö´</div>
          <h1 className="text-2xl font-bold text-gray-800 mb-2">–î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω</h1>
          <p className="text-gray-600">
            –≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –≤ Telegram Mini Apps.
          </p>
          <p className="text-sm text-gray-500 mt-4">
            –û—Ç–∫—Ä–æ–π—Ç–µ —ç—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram Bot.
          </p>
        </div>
      </div>
    );
  }

  const currentChat = getCurrentChat();

  return (
    <div className="flex flex-col h-screen bg-gradient-to-b from-blue-50 to-white">
      <div className="bg-white shadow-sm border-b border-gray-200 px-4 py-3 animate-slideDown">
        <h1 className="text-xl font-bold text-gray-800 flex items-center gap-2">
          <span className="text-2xl">ü§ñ</span>
          Pollinations AI
        </h1>
      </div>

      <div className="flex-1 overflow-hidden">
        {currentTab === 'chat' && (
          <div className="flex flex-col h-full">
            <div className="px-4 py-6 bg-gradient-to-r from-blue-500 to-indigo-600 text-white animate-fadeIn">
              <h2 className="text-2xl font-bold">{getGreeting()}, {userName}!</h2>
              <p className="text-blue-100 text-sm mt-1">–ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å —Å–µ–≥–æ–¥–Ω—è?</p>
            </div>

            <div className="flex-1 overflow-y-auto px-4 py-4 space-y-4">
              {currentChat?.messages.map((msg, idx) => (
                <div
                  key={idx}
                  className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'} animate-slideUp`}
                  style={{ animationDelay: `${idx * 0.05}s` }}
                >
                  <div
                    className={`max-w-[80%] rounded-2xl px-4 py-3 ${
                      msg.role === 'user'
                        ? 'bg-blue-500 text-white'
                        : 'bg-white text-gray-800 shadow-md border border-gray-100'
                    }`}
                  >
                    {msg.image && msg.role === 'user' && (
                      <img src={msg.image} alt="Uploaded" className="rounded-lg mb-2 max-w-full" />
                    )}
                    <div
                      dangerouslySetInnerHTML={{ __html: renderMarkdown(msg.content) }}
                      className="prose prose-sm max-w-none"
                    />
                    {msg.isGenerating && (
                      <div className="flex items-center gap-2 mt-2">
                        <Loader className="w-4 h-4 animate-spin" />
                        <span className="text-sm">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è...</span>
                      </div>
                    )}
                  </div>
                </div>
              ))}
              {isLoading && (
                <div className="flex justify-start animate-pulse">
                  <div className="bg-white rounded-2xl px-4 py-3 shadow-md border border-gray-100">
                    <div className="flex gap-2">
                      <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '0s' }} />
                      <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '0.2s' }} />
                      <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '0.4s' }} />
                    </div>
                  </div>
                </div>
              )}
              <div ref={messagesEndRef} />
            </div>

            {showModelSelector && (
              <div className="absolute bottom-20 left-0 right-0 bg-white border-t border-gray-200 max-h-64 overflow-y-auto shadow-lg animate-slideUp z-50">
                {models.map((model) => (
                  <button
                    key={model.name}
                    onClick={() => {
                      setSelectedModel(model.name);
                      setShowModelSelector(false);
                    }}
                    className={`w-full text-left px-4 py-3 hover:bg-blue-50 transition-colors ${
                      selectedModel === model.name ? 'bg-blue-100' : ''
                    }`}
                  >
                    <div className="font-semibold text-sm">{model.name}</div>
                    <div className="text-xs text-gray-600 mt-1">{model.description}</div>
                  </button>
                ))}
              </div>
            )}

            <div className="bg-white border-t border-gray-200 p-4 space-y-3">
              <button
                onClick={() => setShowModelSelector(!showModelSelector)}
                className="w-full flex items-center justify-between px-4 py-2 bg-gray-100 rounded-xl hover:bg-gray-200 transition-colors"
              >
                <span className="text-sm font-medium text-gray-700">
                  {models.find(m => m.name === selectedModel)?.name || selectedModel}
                </span>
                <ChevronDown className={`w-4 h-4 transition-transform ${showModelSelector ? 'rotate-180' : ''}`} />
              </button>

              {uploadedImage && (
                <div className="relative inline-block animate-fadeIn">
                  <img src={uploadedImage} alt="Preview" className="h-20 rounded-lg" />
                  <button
                    onClick={() => setUploadedImage(null)}
                    className="absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1"
                  >
                    <X className="w-4 h-4" />
                  </button>
                </div>
              )}

              <div className="flex gap-2">
                <input
                  type="file"
                  ref={fileInputRef}
                  onChange={handleImageUpload}
                  accept="image/*"
                  className="hidden"
                />
                <button
                  onClick={() => fileInputRef.current?.click()}
                  className="p-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-colors"
                >
                  <Image className="w-5 h-5" />
                </button>
                <input
                  type="text"
                  value={message}
                  onChange={(e) => setMessage(e.target.value)}
                  onKeyPress={(e) => e.key === 'Enter' && !isLoading && sendMessage()}
                  placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."
                  className="flex-1 px-4 py-3 bg-gray-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                  disabled={isLoading}
                />
                <button
                  onClick={sendMessage}
                  disabled={isLoading || (!message.trim() && !uploadedImage)}
                  className="p-3 bg-blue-500 text-white rounded-xl hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors"
                >
                  <Send className="w-5 h-5" />
                </button>
              </div>
            </div>
          </div>
        )}

        {currentTab === 'history' && (
          <div className="h-full overflow-y-auto p-4 animate-fadeIn">
            <div className="flex items-center justify-between mb-4">
              <h2 className="text-xl font-bold text-gray-800">–ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–æ–≤</h2>
              <button
                onClick={createNewChat}
                className="p-2 bg-blue-500 text-white rounded-xl hover:bg-blue-600 transition-colors"
              >
                <Plus className="w-5 h-5" />
              </button>
            </div>
            <div className="space-y-2">
              {chats.map((chat, idx) => (
                <div
                  key={chat.id}
                  className="bg-white rounded-xl shadow-sm border border-gray-200 p-4 hover:shadow-md transition-shadow animate-slideUp"
                  style={{ animationDelay: `${idx * 0.05}s` }}
                >
                  <div className="flex items-center justify-between">
                    <button
                      onClick={() => {
                        setCurrentChatId(chat.id);
                        setCurrentTab('chat');
                      }}
                      className="flex-1 text-left"
                    >
                      <h3 className="font-semibold text-gray-800">{chat.title}</h3>
                      <p className="text-sm text-gray-500 mt-1">
                        {chat.messages.length} —Å–æ–æ–±—â–µ–Ω–∏–π ¬∑ {new Date(chat.createdAt).toLocaleDateString()}
                      </p>
                    </button>
                    <button
                      onClick={() => deleteChat(chat.id)}
                      className="p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors"
                    >
                      <X className="w-5 h-5" />
                    </button>
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}

        {currentTab === 'settings' && (
          <div className="h-full overflow-y-auto p-4 animate-fadeIn">
            <h2 className="text-xl font-bold text-gray-800 mb-4">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
            <div className="space-y-4">
              <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-4">
                <label className="flex items-center justify-between">
                  <span className="font-medium text-gray-800">–ü–æ—Ç–æ–∫–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è</span>
                  <input
                    type="checkbox"
                    checked={settings.streaming}
                    onChange={(e) => setSettings({ ...settings, streaming: e.target.checked })}
                    className="w-5 h-5 text-blue-500"
                  />
                </label>
                <p className="text-sm text-gray-500 mt-2">–û—Ç–≤–µ—Ç—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ</p>
              </div>

              <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-4">
                <label className="block font-medium text-gray-800 mb-2">–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç</label>
                <textarea
                  value={settings.systemPrompt}
                  onChange={(e) => setSettings({ ...settings, systemPrompt: e.target.value })}
                  className="w-full px-3 py-2 bg-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 min-h-[100px]"
                />
              </div>

              <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-4">
                <label className="block font-medium text-gray-800 mb-2">
                  –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: {settings.temperature}
                </label>
                <input
                  type="range"
                  min="0"
                  max="2"
                  step="0.1"
                  value={settings.temperature}
                  onChange={(e) => setSettings({ ...settings, temperature: parseFloat(e.target.value) })}
                  className="w-full"
                />
                <p className="text-sm text-gray-500 mt-2">–£–ø—Ä–∞–≤–ª—è–µ—Ç –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å—é –æ—Ç–≤–µ—Ç–æ–≤</p>
              </div>

              <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-4">
                <label className="block font-medium text-gray-800 mb-2">–í–∞—à–µ –∏–º—è</label>
                <input
                  type="text"
                  value={userName}
                  onChange={(e) => setUserName(e.target.value)}
                  className="w-full px-3 py-2 bg-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
              </div>
            </div>
          </div>
        )}
      </div>

      <div className="bg-white border-t border-gray-200 px-4 py-2 flex justify-around animate-slideUp">
        <button
          onClick={() => setCurrentTab('history')}
          className={`flex flex-col items-center gap-1 px-6 py-2 rounded-xl transition-all ${
            currentTab === 'history'
              ? 'bg-blue-100 text-blue-600'
              : 'text-gray-600 hover:bg-gray-100'
          }`}
        >
          <History className="w-6 h-6" />
          <span className="text-xs font-medium">–ò—Å—Ç–æ—Ä–∏—è</span>
        </button>
        <button
          onClick={() => setCurrentTab('chat')}
          className={`flex flex-col items-center gap-1 px-6 py-2 rounded-xl transition-all ${
            currentTab === 'chat'
              ? 'bg-blue-100 text-blue-600'
              : 'text-gray-600 hover:bg-gray-100'
          }`}
        >
          <MessageSquare className="w-6 h-6" />
          <span className="text-xs font-medium">–ß–∞—Ç</span>
        </button>
        <button
          onClick={() => setCurrentTab('settings')}
          className={`flex flex-col items-center gap-1 px-6 py-2 rounded-xl transition-all ${
            currentTab === 'settings'
              ? 'bg-blue-100 text-blue-600'
              : 'text-gray-600 hover:bg-gray-100'
          }`}
        >
          <Settings className="w-6 h-6" />
          <span className="text-xs font-medium">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
        </button>
      </div>

      <style>{`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        
        @keyframes slideUp {
          from {
            opacity: 0;
            transform: translateY(20px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        @keyframes slideDown {
          from {
            opacity: 0;
            transform: translateY(-20px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        .animate-fadeIn {
          animation: fadeIn 0.3s ease-out;
        }
        
        .animate-slideUp {
          animation: slideUp 0.3s ease-out forwards;
        }
        
        .animate-slideDown {
          animation: slideDown 0.3s ease-out;
        }
        
        .message-image {
          max-width: 100%;
          border-radius: 0.5rem;
          margin-top: 0.5rem;
        }
        
        .prose code {
          background: rgba(0, 0, 0, 0.1);
          padding: 0.125rem 0.25rem;
          border-radius: 0.25rem;
          font-size: 0.875em;
        }
        
        .prose strong {
          font-weight: 600;
        }
        
        .prose em {
          font-style: italic;
        }
      `}</style>
    </div>
  );
};

export default App;
